#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Quality Gates - Pre-Commit"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# ESLint
echo "ğŸ“ Verificando ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint falhou! Corrija os erros antes de commitar."
  exit 1
fi

# TypeScript
echo "ğŸ”§ Verificando TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript falhou! Corrija os erros antes de commitar."
  exit 1
fi

# Console.log Check (FASE 1 - Avisos apenas, nÃ£o bloqueia)
echo "ğŸ“Š Verificando uso de console.log/error/warn..."
CONSOLE_USAGE=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -n "console\.\(log\|error\|warn\)" 2>/dev/null || true)

if [ -n "$CONSOLE_USAGE" ]; then
  echo ""
  echo "âš ï¸  AVISO: Encontrado console.log/error/warn nos arquivos:"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "$CONSOLE_USAGE"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "ğŸ“ RECOMENDAÃ‡ÃƒO: Migre para logger.info/error/warn"
  echo "ğŸ“– Veja: docs/STANDARDS-SECTION-13-LOGGING.md"
  echo ""
  echo "âš ï¸  FASE 1: Este Ã© apenas um AVISO (commit permitido)"
  echo "ğŸ”’ FASE 2: ApÃ³s migraÃ§Ã£o completa, commits serÃ£o bloqueados"
  echo ""
fi

echo "âœ… Quality Gates passaram! Commit permitido."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
